{
  "name": "ClickUp - Tasks - RAG",
  "nodes": [
    {
      "parameters": {
        "content": "## Almacenar tareas\n",
        "height": 688,
        "width": 704
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1360,
        -352
      ],
      "typeVersion": 1,
      "id": "7b4a1a69-efe2-49dd-a826-c011784809e9",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "=Eres un asistente técnico institucional integrado con ClickUp. \nTu conocimiento proviene únicamente de fragmentos en formato JSON entregados desde la tool `tareas_completadas`, que ya filtra las tareas con estado DONE. \nNo inventes información ni campos que no estén presentes en el JSON.\n\n## Reglas\n1. Para listar tareas en estado DONE, usa siempre la tool `tareas_completadas`.\n2. Devuelve máximo 10 tareas por respuesta.\n3. Usa el formato:\n   - Título: <title>\n     - Estado: <status>\n     - Creador: <creator>\n     - Fecha de actualización: <updated_at>\n     - Url: <url>\n4. Si hay más de 10 tareas relevantes, indica:  \n   \"Hay más resultados, pide 'siguiente' para continuar\".\n5. Si no hay tareas en estado DONE, responde:  \n   \"No dispongo de información suficiente\".\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        2336,
        -288
      ],
      "id": "bdecd789-bc4e-480e-9284-0ff005b8a87c",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        2160,
        -288
      ],
      "id": "ef443e43-e9ef-4485-b81f-70af88fbeb50",
      "name": "When chat message received",
      "webhookId": "6c8d9157-f52b-440b-b7ea-34e281863b1f"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d5e2bfba-9603-4b23-a1ad-fe0a8c10239c",
              "name": "id",
              "value": "={{ $('ClickUp - Listar tareas').item.json.id }}",
              "type": "string"
            },
            {
              "id": "82f03019-4a64-4694-9ad2-fa0da0290ad8",
              "name": "titulo",
              "value": "={{ $('ClickUp - Listar tareas').item.json.name }}",
              "type": "string"
            },
            {
              "id": "32f1222c-5087-4cb2-8fbf-c3f2d8e83e7d",
              "name": "descripcion",
              "value": "={{ $('ClickUp - Listar tareas').item.json.description }}",
              "type": "string"
            },
            {
              "id": "baea74c2-08b1-4623-b8ab-145329c6ea53",
              "name": "estado",
              "value": "={{ $('ClickUp - Listar tareas').item.json.status.status }}",
              "type": "string"
            },
            {
              "id": "86f43dee-172a-4616-8bae-784b936b1223",
              "name": "creador",
              "value": "={{ $('ClickUp - Listar tareas').item.json.creator.username }}",
              "type": "string"
            },
            {
              "id": "ed6d35fe-3954-45cf-b942-4ac04287ed57",
              "name": "asignados",
              "value": "={{ $('ClickUp - Listar tareas').item.json.assignees.map(assignee => assignee.username).toJsonString() }}",
              "type": "array"
            },
            {
              "id": "36a254dc-b596-43c6-9726-93ba5962b7e4",
              "name": "fecha_creacion",
              "value": "={{ (new Date($('ClickUp - Listar tareas').item.json.date_created *1)).toLocaleString('es-ES', { timeZone: 'UTC' }) }}",
              "type": "string"
            },
            {
              "id": "f42fb5f9-b82b-4e36-9802-3919828a2399",
              "name": "raw_date_created",
              "value": "={{ $('ClickUp - Listar tareas').item.json.date_created }}",
              "type": "string"
            },
            {
              "id": "34e8cc82-888c-47c2-88ea-917ed50f0b2b",
              "name": "fecha_actualizacion",
              "value": "={{ (new Date($('ClickUp - Listar tareas').item.json.date_updated *1)).toLocaleString('es-ES', { timeZone: 'UTC' }) }}",
              "type": "string"
            },
            {
              "id": "1d9e1024-78e0-4790-871c-707b0470e524",
              "name": "raw_date_updated",
              "value": "={{ $('ClickUp - Listar tareas').item.json.date_updated }}",
              "type": "string"
            },
            {
              "id": "e914dd36-8f66-4937-9424-589e1cae80d0",
              "name": "fecha_cierre",
              "value": "={{ $('ClickUp - Listar tareas').item.json.date_closed && (new Date($('ClickUp - Listar tareas').item.json.date_closed *1)).toLocaleString('es-ES', { timeZone: 'UTC' }) }}",
              "type": "string"
            },
            {
              "id": "76d23ba9-b62d-4fcc-93b0-9c8973f22dd1",
              "name": "raw_date_closed",
              "value": "={{ $('ClickUp - Listar tareas').item.json.date_closed }}",
              "type": "string"
            },
            {
              "id": "5895a9d3-2ec8-42ee-983b-803c5aceb7eb",
              "name": "fecha_terminado",
              "value": "={{ $('ClickUp - Listar tareas').item.json.date_done && (new Date($('ClickUp - Listar tareas').item.json.date_done *1)).toLocaleString('es-ES', { timeZone: 'UTC' }) }}",
              "type": "string"
            },
            {
              "id": "311b983a-99a2-46ea-b375-8c5b07f370f7",
              "name": "raw_date_done",
              "value": "={{ $('ClickUp - Listar tareas').item.json.date_done }}",
              "type": "string"
            },
            {
              "id": "1f592ed9-1052-4ede-8356-dae7f79c2908",
              "name": "url",
              "value": "={{ $('ClickUp - Listar tareas').item.json.url }}",
              "type": "string"
            },
            {
              "id": "b2277d11-3f58-4c12-b185-e16e55154da7",
              "name": "archivado",
              "value": "={{ $('ClickUp - Listar tareas').item.json.archived }}",
              "type": "boolean"
            },
            {
              "id": "a9110ec1-50fd-4e87-8193-3ce50da53027",
              "name": "custom_fields",
              "value": "={{ $('ClickUp - Listar tareas').item.json.custom_fields.map(field => `${field.name}: ${Array.isArray(field.value) ? field.value.map(id => Object.fromEntries(field.type_config.options.map(o => [o.id, o.label]))[id]).toJsonString(): field.value || null}`) }}",
              "type": "array"
            },
            {
              "id": "649355d3-a11e-4ddf-ab4a-4ff00d76623a",
              "name": "subtareas",
              "value": "={{ ($('ClickUp - Listar tareas').item.json.subtasks || []).map(t => ({subtarea_titulo:t.name,subtarea_estado:t.status.status,subtarea_actualizada:t.date_updated, subtarea_creador:t.creator.username,subtarea_url:t.url})).toJsonString() }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        192,
        -176
      ],
      "id": "14faaca5-4f43-4929-9ef3-f27fc1ebf122",
      "name": "ClickUp - Campos Esenciales"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        2048,
        176
      ],
      "id": "219561d4-5454-4728-bac1-d246134f12cd",
      "name": "Embeddings Google Gemini",
      "credentials": {
        "googlePalmApi": {
          "id": "SkZXoDWFFDsbxlrH",
          "name": "Google Gemini(PaLM) - blacknoob20@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "description": "=Eres un asistente técnico institucional integrado con ClickUp. \nTu tarea principal es listar las tareas que están en estado DONE. \nNo inventes información ni campos que no estén presentes en el JSON.\n\nReglas:\n1. Devuelve máximo 10 tareas por respuesta.\n2. Usa el formato:\n   - Título: <title>\n     - Estado: <status>\n     - Creador: <creator>\n     - Fecha de actualización: <updated_at>\n     - Url: <url>\n3. Si hay más de 10 tareas, indica: \"Hay más resultados, pide 'siguiente' para continuar\".\n4. Si no hay tareas en estado DONE, responde: \"No dispongo de información suficiente\".\n",
        "topK": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1.1,
      "position": [
        2480,
        -112
      ],
      "id": "f459ae79-9b10-4621-bfdc-417c5b625f73",
      "name": "Answer questions with a vector store"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        2400,
        48
      ],
      "id": "d162a9c7-dd95-432b-a6f7-2f1070b05eb1",
      "name": "PGVector Store",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "embeddingBatchSize": 250,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.3,
      "position": [
        1408,
        -288
      ],
      "id": "106363be-c02e-41d2-9364-db2773cf44b9",
      "name": "Almacenar Tareas ClickUp",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2656,
        48
      ],
      "id": "1549e90d-c8d5-4831-a5ce-9ca73c6cf61b",
      "name": "Gemini Model",
      "credentials": {
        "googlePalmApi": {
          "id": "SkZXoDWFFDsbxlrH",
          "name": "Google Gemini(PaLM) - blacknoob20@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2240,
        -112
      ],
      "id": "f247396b-3cba-4a3a-bf75-f3b936be6eb4",
      "name": "Gemini Chat",
      "credentials": {
        "googlePalmApi": {
          "id": "SkZXoDWFFDsbxlrH",
          "name": "Google Gemini(PaLM) - blacknoob20@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        2368,
        -112
      ],
      "id": "4a1feccf-191a-49b8-86e8-e705c8a92a70",
      "name": "Chat Memory",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "content": "## Agente ClickUp",
        "height": 688,
        "width": 768,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2112,
        -352
      ],
      "typeVersion": 1,
      "id": "96d52515-41ba-4c81-979a-977b89bb5afd",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select count(*) as ingested from ingested_tasks\nwhere task_id = '{{ $json.id }}' and modified_time = TIMESTAMP'{{ new Date($('ClickUp - Listar tareas').item.json.date_updated *1).toISOString().replace('T',' ').split('.')[0] }}'",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -160,
        -192
      ],
      "id": "b62d19a2-43f2-4fab-84a6-c724a43b94a4",
      "name": "Obtener carga previa",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "974ed4c4-499a-41ed-9bfa-97f157ff9755",
              "leftValue": "={{ $json.ingested }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        0,
        -192
      ],
      "id": "031a47ba-bbf2-49f9-8e03-92c9c1b8627b",
      "name": "¿Fue previamente cargado?"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        192,
        -336
      ],
      "id": "9d7f6971-af1e-4337-8f09-db4898d1857c",
      "name": "No hacer nada"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from n8n_vectors where task_id= '{{ $('ClickUp - Campos Esenciales').item.json.id }}'",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        688,
        -112
      ],
      "id": "8d803417-b1eb-42e4-8df0-b4ce2b7f5402",
      "name": "Borrar referencias",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "mode": "chooseBranch"
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        976,
        -160
      ],
      "id": "6eeeb74f-6cb7-4927-8e27-54a998944c8e",
      "name": "Esperar eliminación"
    },
    {
      "parameters": {
        "content": "## Selección de tareas\n",
        "height": 688,
        "width": 2848,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1536,
        -352
      ],
      "typeVersion": 1,
      "id": "250f2c24-ad00-49bf-a6c7-dc99169fb4ff",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE n8n_vectors\nSET task_id = '{{ $('ClickUp - Campos Esenciales').item.json.id }}'\nWHERE metadata->>'id' = '{{ $json.metadata.id }}' and task_id is null",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1696,
        -288
      ],
      "id": "6cdf65ed-e627-4fa5-a706-094757658963",
      "name": "Actualizar task_id en vectores",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1856,
        -288
      ],
      "id": "9c22b39f-911c-4746-990a-f34f261ad588",
      "name": "Terminar proceso"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1456,
        -272
      ],
      "id": "7f12f6ef-a2eb-44c2-aca2-58b305b62308",
      "name": "Iniciar"
    },
    {
      "parameters": {
        "chunkSize": 1500,
        "chunkOverlap": 300,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        1408,
        96
      ],
      "id": "8c3b6e25-d51b-4042-b98d-24dfc7c46e6b",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT to_regclass('public.n8n_vectors') IS NOT NULL AS exists",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        352,
        -16
      ],
      "id": "cb93872f-3e9d-4a0d-8540-97ff30466cfe",
      "name": "Buscar tabla vectores",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5645e85e-73fe-4bf9-8df7-35e3acda0823",
              "leftValue": "={{ $json.exists }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        528,
        96
      ],
      "id": "942ee246-3b5f-47d9-a5cd-a25a4b19118d",
      "name": "¿Borrar si existe la tabla?"
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $('ClickUp - Campos Esenciales').item.json.toJsonString()}}",
        "textSplittingMode": "custom",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "id",
                "value": "={{ $json.task_id }}"
              },
              {
                "name": "estado",
                "value": "={{$json.task_status}}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        1376,
        -64
      ],
      "id": "80bed57d-e149-4b1f-be3d-0bd05f488a2a",
      "name": "Insertar Tareas"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "ingested_tasks",
          "mode": "list",
          "cachedResultName": "ingested_tasks"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "task_id": "={{ $json.id }}",
            "title": "={{ $json.titulo }}",
            "creator": "={{ $json.creador }}",
            "task_status": "={{ $json.estado }}",
            "modified_time": "={{ new Date($json.raw_date_updated *1).toISOString().replace('T',' ').split('.')[0] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creator",
              "displayName": "creator",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "task_status",
              "displayName": "task_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "modified_time",
              "displayName": "modified_time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "last_ingested",
              "displayName": "last_ingested",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1168,
        -160
      ],
      "id": "72720ca7-ae61-4415-bdb3-d4d3f0f31fd3",
      "name": "Llenar ingested tasks",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select * from n8n_vectors where metadata->>'estado' = 'complete'",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        2736,
        -112
      ],
      "id": "cc9cb0db-83e3-4ab4-a514-0d9a1511dfec",
      "name": "tareas_completadas",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select \n  (SELECT (EXTRACT(EPOCH FROM COALESCE(MAX(modified_time), TIMESTAMP '2025-11-15 00:00:00')) * 1000) ::bigint FROM ingested_tasks) AS modified_time,\n  (select count(1) from clickup_tasks) as total_clickup_task;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1296,
        -272
      ],
      "id": "c9112da3-ff0e-4560-838f-26ffa6b5c561",
      "name": "Obtener última actualización",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "clickup_tasks",
          "mode": "list",
          "cachedResultName": "clickup_tasks"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "task_id": "={{ $json.id }}",
            "data": "={{ $json }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            },
            {
              "id": "inserted_at",
              "displayName": "inserted_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -368,
        -288
      ],
      "id": "743251c3-49c8-4546-aa7b-9d62c5701140",
      "name": "Insertar ClickUp Response",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3ae89aaf-0d07-42d5-a688-aa6ba8130209",
              "leftValue": "={{ $('Obtener última actualización').item.json.total_clickup_task }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -928,
        -272
      ],
      "id": "185dbc91-f76a-4187-8b07-bd3266e17879",
      "name": "No hay carga inicial?"
    },
    {
      "parameters": {
        "operation": "getAll",
        "team": "3121590",
        "space": "=3241325",
        "folder": "=90172621115",
        "list": "=901703156817",
        "filters": {
          "dateUpdatedGt": "={{ $json.modified_time }}",
          "includeClosed": true,
          "orderBy": "updated",
          "subtasks": true
        }
      },
      "type": "n8n-nodes-base.clickUp",
      "typeVersion": 1,
      "position": [
        -1120,
        -272
      ],
      "id": "9a03d3fc-8821-489d-befd-6a302972c80a",
      "name": "ClickUp - Listar tareas",
      "credentials": {
        "clickUpApi": {
          "id": "sVwdzQKKDrxlNohA",
          "name": "ClickUp account - Soporte Guayas"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select count(1),id from clickup_tasks where task_id = '{{ $('ClickUp - Listar tareas').item.json.id }}' group by id",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -736,
        -80
      ],
      "id": "324b829e-ad61-4f07-a0b5-2604f07315de",
      "name": "Buscar tarea",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7e448f18-53b0-412e-b661-ff772a7c5d27",
              "leftValue": "={{ $json.count }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -560,
        -80
      ],
      "id": "24016d20-8f02-44c8-a3ea-7dbabd18574c",
      "name": "Existe tarea?"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "clickup_tasks",
          "mode": "list",
          "cachedResultName": "clickup_tasks"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "task_id": "='{{ $('ClickUp - Listar tareas').item.json.id }}'",
            "data": "={{ $('ClickUp - Listar tareas').item.json }}",
            "inserted_at": "='{{ (new Date()).toISOString() }}'",
            "id": 0
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "inserted_at",
              "displayName": "inserted_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -368,
        -96
      ],
      "id": "3066316a-1718-4d8b-abab-f7f4ba1221c5",
      "name": "Update rows in a table",
      "credentials": {
        "postgres": {
          "id": "wJyvDHVfFHpmngoR",
          "name": "Postgres account - ClickUp Tasks"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ClickUp - Campos Esenciales": {
      "main": [
        [
          {
            "node": "Esperar eliminación",
            "type": "main",
            "index": 0
          },
          {
            "node": "Buscar tabla vectores",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini": {
      "ai_embedding": [
        [
          {
            "node": "Almacenar Tareas ClickUp",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "PGVector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Answer questions with a vector store": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "PGVector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "Answer questions with a vector store",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Model": {
      "ai_languageModel": [
        [
          {
            "node": "Answer questions with a vector store",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Chat": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Obtener carga previa": {
      "main": [
        [
          {
            "node": "¿Fue previamente cargado?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿Fue previamente cargado?": {
      "main": [
        [
          {
            "node": "No hacer nada",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ClickUp - Campos Esenciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Borrar referencias": {
      "main": [
        [
          {
            "node": "Esperar eliminación",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Esperar eliminación": {
      "main": [
        [
          {
            "node": "Llenar ingested tasks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Almacenar Tareas ClickUp": {
      "main": [
        [
          {
            "node": "Actualizar task_id en vectores",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar task_id en vectores": {
      "main": [
        [
          {
            "node": "Terminar proceso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Iniciar": {
      "main": [
        [
          {
            "node": "Obtener última actualización",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Insertar Tareas",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Buscar tabla vectores": {
      "main": [
        [
          {
            "node": "¿Borrar si existe la tabla?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿Borrar si existe la tabla?": {
      "main": [
        [
          {
            "node": "Borrar referencias",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Esperar eliminación",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Insertar Tareas": {
      "ai_document": [
        [
          {
            "node": "Almacenar Tareas ClickUp",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Llenar ingested tasks": {
      "main": [
        [
          {
            "node": "Almacenar Tareas ClickUp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tareas_completadas": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Obtener última actualización": {
      "main": [
        [
          {
            "node": "ClickUp - Listar tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insertar ClickUp Response": {
      "main": [
        [
          {
            "node": "Obtener carga previa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No hay carga inicial?": {
      "main": [
        [
          {
            "node": "Insertar ClickUp Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Buscar tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ClickUp - Listar tareas": {
      "main": [
        [
          {
            "node": "No hay carga inicial?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar tarea": {
      "main": [
        [
          {
            "node": "Existe tarea?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Existe tarea?": {
      "main": [
        [
          {
            "node": "Update rows in a table",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Insertar ClickUp Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update rows in a table": {
      "main": [
        [
          {
            "node": "Obtener carga previa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "add01d3a-c66c-4688-a311-e6ea35e3b5bb",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "dfe878e4337a9a6094362e06023e91a757750bd9770a4d56013225bc19da1117"
  },
  "id": "OXlJKMnY2JPoVJQz",
  "tags": []
}